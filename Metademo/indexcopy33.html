  <!DOCTYPE html>
<html>
  <head>
    <title>Archway cobbles</title>
     <meta name="description" content="Archway cobbles">
   <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
  <script src="aframe-stereo-component.min.js"></script>
  <script src="https://cdn.rawgit.com/zcanter/aframe-gradient-sky/master/dist/gradientsky.min.js"></script>
     <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
  <script src="controller-listener.js"></script>
  <script src="player-move.js"></script>
    <script src="raycaster-extras.js"></script>
       
     <script src="joystick.js"></script> 
     <script src="extended-wasd-controls.js"></script>
<style>

body
.mainUI
{
  border: 0px solid pink; 
  position: fixed; 
  top: 0px;  
  width:99%; 
  height:99%; 
  z-index: 1; 
  pointer-events: none; /* allow click-through in transparent areas */
}

.regionUI
{
  border: 0px solid yellow;
  position: absolute; 
  display: flex;
  flex-direction: row;
  pointer-events: none;
}

.buttonUI
{
  border: 0px solid lime;
  display: flex;
  flex-direction: column;
  justify-content: center;
  pointer-events: auto; 
  filter: drop-shadow(0px 0px 20px white);
}

</style>
<script>
  AFRAME.components["look-controls"].Component.prototype.onTouchMove = function (t) {
    if (this.touchStarted && this.data.touchEnabled) {
        this.pitchObject.rotation.x += .6 * Math.PI * (t.touches[0].pageY - this.touchStart.y) / this.el.sceneEl.canvas.clientHeight;
        this.yawObject.rotation.y += /*  */ Math.PI * (t.touches[0].pageX - this.touchStart.x) / this.el.sceneEl.canvas.clientWidth;
        this.pitchObject.rotation.x = Math.max(Math.PI / -2, Math.min(Math.PI / 2, this.pitchObject.rotation.x));
        this.touchStart = {
            x: t.touches[0].pageX,
            y: t.touches[0].pageY
        }
    }
}
</script>

<script>

  // need to run javascript code after a-scene entities and components are loaded
  AFRAME.registerComponent('screen-controls', 
  {
    init: function () 
    {
        this.component = document.getElementById("camera").components["extended-wasd-controls"];
        this.joystick1 = new Joystick("stick1", 64, 8);
        console.log("controls initialized");
      },

      tick: function(time, deltaTime)
      {
        // console.log( joystick1.value )
        // console.log( this.component.movePercent )
        this.component.movePercent.x =  this.joystick1.value.x;
        this.component.movePercent.z = -this.joystick1.value.y;
        
      }
  });


</script>

  </head>
  <body>
<div class="mainUI" id="uiDiv" oncontextmenu="return false;">
      <div class="regionUI" style="bottom: 10px; left: 10px;">
    <div class="buttonUI" style="width: 128px; opacity:0.80;">
      <img src="joystick-base.png"/>
      <div id="stick1" style="position: absolute; left:25px; top:25px;">
      <img src="joystick-red.png" style="width: 80px;"/>    
      </div>
    </div>
  </div>
</div>


    <a-scene
    renderer="colorManagement: true"
      antialias="true"
      gltf-model="dracoDecoderPath: assets/"
      cursor="rayOrigin: mouse; fuse: false" 
      device-orientation-permission-ui="enabled: true"
     screen-controls >


      <a-assets>
  
        <img id="sky" src="assets/Screenshot 2022-08-22 at 17 (1).jpg" crossorigin="anonymous" />
        
        <img id="screen" src="screen.png" crossorigin="anonymous" />
          
            <a-asset-items id="fer" src= "assets/fer.glb" ></a-assets-items>
            	<a-asset-items id="scene" src= "assets/ferkh.glb" ></a-assets-items>
            	<a-asset-items id="shoe" src= "assets/ggdb.glb" ></a-assets-items>
           
      </a-assets>
      
     
   <a-entity 
        id="player" 
        position="0 0 0" 
        player-move="controllerListenerId: #controller-data;
                     navigationMeshClass: environmentGround;">
      
        
        
      
           <a-camera id="camera" camera look-controls="reverseTouchDrag: true" wasd-controls
    position="0.5 1.6 0.5"
    extended-wasd-controls="flyEnabled: true; inputType: joystick;">
  </a-camera>
   

        <a-entity 
            id="controller-data" 
            controller-listener="leftControllerId:  #left-controller; 
                                 rightControllerId: #right-controller;">
        </a-entity>

  <a-entity 
            id="left-controller"
            oculus-touch-controls="hand: left"
            raycaster="objects: .raycaster-target, .environmentGround;"
            raycaster-extras="controllerListenerId: #controller-data; 
                              beamImageSrc: #gradient; beamLength: 0.5;"
                              static-body="shape: sphere; sphereRadius: 0.02;"
        vive-controls="hand: left"
        sphere-collider="objects: .throwable"
        grab>
        </a-entity>

        <a-entity
            id="right-controller"
            oculus-touch-controls="hand: right"
            raycaster="objects: .raycaster-target, .environmentGround;"
            raycaster-extras="controllerListenerId: #controller-data; 
                              beamImageSrc: #gradient; beamLength: 0.5;"
                                static-body="shape: sphere; sphereRadius: 0.02;"
        vive-controls="hand: right"
        sphere-collider="objects: .throwable"
        grab>
        </a-entity>


  </a-entity>
          
     

     

      <a-sky src="#sky" rotation="0 90 180"></a-sky>



    <a-entity light="color: ffaaff; intensity: 0.1" position="5 5 5"></a-entity>
    
      <a-entity light="color: white; type: ambient;"></a-entity>

      
       

 
 <a-image src="#screen" scale="0.2 0.2 0.2" opacity="0.95"  position="0 1 0" rotation="-30 0 0" width="4" height="1.5"></a-image>

  
   <a-entity gltf-model="#scene" scale="1 1 1"  position="0 0 -0.3" rotation="0 0 0" animation-mixer="timeScale:1" shadow="receive:true" foo></a-entity>
   <a-entity gltf-model="#shoe" scale="2 2 2"  position="-1 1.6 0" rotation="45 45 0" animation-mixer="timeScale:1" shadow="receive:true" foo animation="property: object3D.rotation.y;
          to: 150; 
          dir: alternate; 
          dur: 6000; 
          loop: true;
          easing: linear"></a-entity>
   
   

   
     

    </a-scene>
  </body>
</html> 