  <!DOCTYPE html>
<html>
  <head>
    <title>Vaporwave - A-Frame</title>
  <meta name="description" content="Hello, World! - A-Frame">
  <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.0/dist/aframe-extras.min.js"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="raycaster-extras.js"></script>
      <script src="controller-listener.js"></script>
  <script src="player-move.js"></script>
    <script src="physx.release.js"></script>
  <script src="physics.js"></script>

  <script>

AFRAME.registerComponent("physics-grab", {
    init: function () 
    {
        let self = this;

        this.el.addEventListener("raycaster-grabbed", function() {
           self.el.addState("grabbed"); 
        });

        this.el.addEventListener("raycaster-released", function() {
           self.el.removeState("grabbed"); 
        });
    },

    tick: function()
    {

    }
});


</script>


  </head>
  <body>
    <!-- Moon gravity -->
    <a-scene physics="gravity: -1.6" renderer="antialias: true" cursor="rayOrigin: mouse; fuse: false" physx="autoLoad: true; delay: 1000; wasmUrl: physx.release.wasm; useDefaultScene: false;">

       <a-entity 
        id="player" 
        position="0 0 0"
        player-move="controllerListenerId: #controller-data;
                     navigationMeshClass: environmentGround;">
        
        
        <a-camera stereocam="eye:left" orbit-controls="target: 0 1.6 0; minDistance: 1; maxDistance: 10; initialPosition: 0 0 -3"></a-camera>
    
        <a-entity 
            id="controller-data" 
            controller-listener="leftControllerId:  #left-controller; 
                                 rightControllerId: #right-controller;">
        </a-entity>

        <a-entity 
            id="left-controller"
            oculus-touch-controls="hand: left"
            raycaster="objects: .raycaster-target, .environmentGround;"
            raycaster-extras="controllerListenerId: #controller-data; 
                              beamImageSrc: #gradient; beamLength: 0.5;"
                              static-body="shape: sphere; sphereRadius: 0.02;"
        vive-controls="hand: left"
        sphere-collider="objects: .throwable"
        grab>
        </a-entity>

        <a-entity
            id="right-controller"
            oculus-touch-controls="hand: right"
            raycaster="objects: .raycaster-target, .environmentGround;"
            raycaster-extras="controllerListenerId: #controller-data; 
                              beamImageSrc: #gradient; beamLength: 0.5;"
                                static-body="shape: sphere; sphereRadius: 0.02;"
        vive-controls="hand: right"
        sphere-collider="objects: .throwable"
        grab>
        </a-entity>

    </a-entity>
      <!-- Player -->
      

      <!-- Ammo -->
      <a-sphere
      physx-body="type: dynamic;"
            raycaster-target="canGrab: true;"
            physics-grab
        class="throwable"
        dynamic-body
        position="0 0.25 -0.5"
        radius="0.10"
        color="green"
      ></a-sphere>
      <a-sphere
      physx-body="type: dynamic;"
            raycaster-target="canGrab: true;"
            physics-grab
        class="throwable"
        dynamic-body
        position="0.25 0.25 -0.5"
        radius="0.10"
        color="green"
      ></a-sphere>
      <a-sphere
      physx-body="type: dynamic;"
            raycaster-target="canGrab: true;"
            physics-grab
        class="throwable"
        dynamic-body
        position="-0.25 0.25 -0.5"
        radius="0.10"
        color="green"
      ></a-sphere>

      <!--Table to hold the targets -->
      <a-box
        static-body
        position="2 1 0"
        width="2"
        height="0.1"
        depth="2"
        color="grey"
      ></a-box>

      <!-- The targets (will be generated with D3) -->
      <a-entity id="boxes"></a-entity>

      <!-- Ground -->
      <a-plane
      physx-body="type: static;"
        static-body
        rotation="-90 0 0"
        width="10"
        height="10"
        color="black"
      ></a-plane>

      <!-- Sky -->
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
  </body>

  <script>
    const colorScale = d3.scaleSequential(d3.interpolatePlasma);
    const dataset = [];
  
    for (let i = 10; i > 0; i--) {
      dataset.push(i);
    }
  
    let boxes = d3.select('#boxes');
    boxes.selectAll('a-box')
         .data(dataset)
         .enter()
         .append('a-box')
         .attr('height', '0.1')
         .attr('width', function(d, i) {
           return String(0.1 * d);
         })
         .attr('depth', function(d, i) {
           return String(0.1 * d);
         })
         .attr('color', function(d, i) {
           return colorScale(i / 10);
         })
         .attr('position', function(d, i) {
           return '2 ' + (i * 0.1 + 1.1) + ' 0';
         })
         .attr('dynamic-body', '');
  </script>
</html>